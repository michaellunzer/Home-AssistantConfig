homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret homeassistant_latitude
  longitude: !secret homeassistant_longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret homeassistant_elevation
  # metric for Metric, imperial for Imperial
  unit_system: !secret unit_system
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: !secret time_zone
  # Customization file
  customize: !include customize.yaml
  packages: !include_dir_named packages
  # whitelist_external_dirs:
  # - /backup
  # - /config
  # - /addons
  # - /share
  # - /dev
  # - /mnt/backups

shell_command: !include_dir_named shell_command

zone: !include zones.yaml
#I hope this is the right spot for the zone config.

#testing to see if git works again!

#testing to see if git deploy key works!
#  Command to automatically push to github

#    0,30 * * * * /bin/bash -c "cd cd /root/config && git add . && git commit -am 'Daily commit `date`' && git push"


# switch: !include switches.yaml
# device_tracker: !include device_tracker.yaml

recorder:
  db_url: mysql://admin:asdf@core-mariadb/homeassistant
  purge_keep_days: 2
  purge_interval: 2

influxdb:
  host: a0d7b954-influxdb
  port: 8086
  database: homeassistant
  username: !secret influxdb_username
  password: !secret influxdb_password
  max_retries: 3
  default_measurement: state

# Show links to resources in log and frontend
# introduction:

# Enables the frontend
frontend:
  themes: !include_dir_merge_named themes/

# Enables configuration UI
config:

# Enables iOS
ios:
#   push:
#     categories:
#       - name: Alarm
#         identifier: 'alarm'
#         actions:
#           - identifier: 'SILENCE_ALARM'
#             title: 'Silence Alarm'
#             activationMode: 'background'
#             authenticationRequired: no
#             destructive: yes
#             behavior: 'default'
#       - name: Siren
#         identifier: 'siren'
#         actions:
#           - identifier: 'ACTIVATE_SIRENS'
#             title: 'Activate Sirens'
#             activationMode: 'background'
#             authenticationRequired: no
#             destructive: yes
#             behavior: 'default'

# python_script:
# https://github.com/maattdiy/home-assistant-config/blob/master/python_scripts/summary.py


http:
  # Secrets are defined in the file secrets.yaml
  api_password: !secret http_api_password
  # Uncomment this if you acre using SSL/TLS, running in Docker container, etc.
  base_url: !secret http_base_url
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time
history:

# View all events in a logbook
logbook:

# Enables a map showing the location of tracked devices
map:

# Track the sun
sun:

# Weather prediction
# sensor:
#   - platform: yr

# Text to speech
tts:
  - platform: google

# Cloud
cloud:

# folder_watcher:
#   - folder: /config
#   - folder: /backup
#   - folder: /addons
#   - folder: /share
#   - folder: /mnt/backups


# PushBullet Notifications
notify:
  - name: PushBullet
    platform: pushbullet
    api_key: !secret pushbullet_api_key



group: !include_dir_named groups
automation: !include automations.yaml
script: !include scripts.yaml
sensor: !include sensors.yaml

#D-Link Camera
camera:
  - platform: mjpeg
    name: Laundry Camera
    still_image_url: !secret camera_front_door_still_image_url
    mjpeg_url: !secret camera_front_door_mjpeg_url
# Shows device_tracker.tile_kia on a map.
#   - platform: generic
#     name: Kia Tile Map
#     still_image_url: https://maps.googleapis.com/maps/api/staticmap?center={{ states.device_tracker.tile_kia.attributes.latitude }},{{ states.device_tracker.tile_kia.attributes.longitude }}&zoom=17&size=500x500&maptype=roadmap&markers=color:blue%7Clabel:P%7C{{ states.device_tracker.tile_kia.attributes.latitude }},{{ states.device_tracker.tile_kia.attributes.longitude }}
#     limit_refetch_to_url_change: true
# # International Space Station Map
  - platform: generic
    name: ISS
    still_image_url: https://maps.googleapis.com/maps/api/staticmap?center={{ states.binary_sensor.iss.attributes.lat }},{{ states.binary_sensor.iss.attributes.long }}&zoom=5&size=500x500&maptype=roadmap&markers=color:blue%7Clabel:P%7C{{ states.binary_sensor.iss.attributes.lat }},{{ states.binary_sensor.iss.attributes.long }}
    limit_refetch_to_url_change: true

binary_sensor:
  - platform: iss
    show_on_map: False
  - platform: uptimerobot
    api_key: !secret uptimerobot_api_key
## This is for the motion Sensor
#   - platform: mqtt
#     state_topic: 'room_presence/Michael-room'
#     name: 'Michael Room Motion Sensor'
#     payload_on: 1
#     payload_off: 0
#     device_class: 'motion'
#     value_template: '{{ value_json.value }}'

#
# Home Assistant YAML
# Bayesian Binary Sensor
# https://home-assistant.io/components/binary_sensor.bayesian/
#
# Observes many device tracker entities to determine if home or not
#
# http://www.diyfuturism.com/index.php/2017/11/26/presence-detection-with-home-assistant-bayesian-probability/
#
  - platform: bayesian
    prior: 0.5
    name: 'Michael Presence'
    probability_threshold: 0.9
    observations:
    - entity_id: 'device_tracker.lunziphone_wifi'
      prob_given_true: 0.6
      prob_given_false: 0.4
      platform: 'state'
      to_state: 'home'
    - entity_id: 'device_tracker.lunziphone_ios'
      prob_given_true: 0.6
      prob_given_false: 0.4
      platform: 'state'
      to_state: 'home'
    - entity_id: 'sensor.tile_keys_ra_bt'
      prob_given_true: 0.6
      prob_given_false: 0.4
      platform: 'state'
      to_state: 'home'
    # - entity_id: 'sensor.pebble_2_watch_ra_bt'
    #   prob_given_true: 0.9
    #   prob_given_false: 0.2
    #   platform: 'state'
    #   to_state: 'home'
    # - entity_id: 'sensor.pebble_time_round_watch_ra_bt'
    #   prob_given_true: 0.6
    #   prob_given_false: 0.4
    #   platform: 'state'
    #   to_state: 'home'
    # - entity_id: 'device_tracker.brad_nodered'
    #   prob_given_true: 0.8
    #   prob_given_false: 0.2
    #   platform: 'state'
    #   to_state: 'home'
    # - entity_id: 'device_tracker.tile_keys'
    #   prob_given_true: 0.8
    #   prob_given_false: 0.4
    #   platform: 'state'
    #   to_state: 'home'



mqtt:
  broker: !secret MQTT_broker
  username: !secret MQTT_username
  password: !secret MQTT_password
  discovery: true
  discovery_prefix: homeassistant

# cover:
#   - platform: mqtt
#     name: "MQTT Cover"
#     command_topic: "/house/masterbedroom/rollerblind/set"
#     state_topic: "/house/masterbedroom/rollerblind/status"
#     availability_topic: "/house/masterbedroom/rollerblind/availability"
#     qos: 0
#     retain: true
#     payload_open: "OPEN"
#     payload_close: "CLOSE"
#     payload_stop: "STOP"
#     state_open: "open"
#     state_closed: "closed"
#     payload_available: "online"
#     payload_not_available: "offline"
#     optimistic: false
#     value_template: '{{ value.x }}'



panel_iframe:
  configurator:
    title: Configurator
    icon: mdi:wrench
    url: !secret configurator_url
  terminal:
    title: Terminal
    icon: mdi:console
    url: !secret terminal_url
  nodered:
    title: Node-Red
    icon: mdi:shuffle-variant
    url: !secret nodered_url
  sonweb:
    title: SonWEB
    icon: mdi:lightbulb-on
    url: !secret sonweb_url
  grafana:
    title: Grafana
    icon: mdi:chart-timeline
    url: !secret grafana_url
  influxdb:
    title: InfluxDB
    icon: mdi:chart-areaspline
    url: !secret influxdb_url
  esphomeyaml:
    title: esphomeyaml
    icon: mdi:chip
    url: !secret esphomeyaml_url
# Need to open up router accessability to internet to enable this. Potentially use Caddy Proxy plugin ?
#   router:
#     title: Asus Router
#     icon: mdi:router-wireless
#     url: !secret router_url

media_player:
  - platform: mpd
    host: !secret mpd_host_lunzpi
    port: !secret mpd_port_lunzpi
    name: LunzPi
  - platform: spotify
    client_id: !secret spotify_client_id
    client_secret: !secret spotify_client_secret
  - platform: firetv
    device: "FireTV-Stick"
  # - platform: itunes
  #   host: !secret itunes_host

device_tracker:
  - platform: tile
    username: !secret tile_username
    password: !secret tile_password
  - platform: asuswrt
    host: 192.168.1.1
    username: !secret asus_username
    password: !secret asus_password
    consider_home: 0:03
    new_device_defaults:
      track_new_devices: True
#   - platform: icloud
#     username: !secret icloud_username
#     password: !secret icloud_password
#  - platform: bluetooth_tracker                       # Disabled bluetooth tracker on VM

# duckDNS
duckdns:
  domain: !secret duckdns_domain
  access_token: !secret duckdns_access_token




####################################
############### LIGHTS #############
####################################



light:
  - platform: flux_led
    devices:
      192.168.1.121:
        name: flux_bedroom_light
        # protocol: 'ledenet'
  - platform: mqtt_json
    name: "SN1 LED"
    state_topic: "bruh/sensornode1"
    command_topic: "bruh/sensornode1/set"
    brightness: true
    flash: true
    rgb: true
    optimistic: false
    qos: 0
  - platform: group
    name: Michael's Bedroom Lights
    entities:
      - light.mclighting01
      - light.flux_bedroom_light


####################################
############# SWITCHES #############
####################################


switch:
  - platform: wake_on_lan
    mac_address: "D8-CB-8A-70-E9-CB"
    name: "10-LUNZ PC"
    host: 192.168.1.144
    turn_off:
        service: hassio.addon_stdin
        data:
            addon: core_rpc_shutdown
            input: 10-LUNZ
  - platform: tuya
    host: 192.168.1.211
    local_key: !secret tuya_local_key
    device_id: !secret tuya_device_id
    switches:
      switch1:
        friendly_name: Zerver External HD
        id: 1
      switch2:
        friendly_name: Fireplace
        id: 2
      switch3:
        friendly_name: Monitor
        id: 3
      switch4:
        friendly_name: Lamp
        id: 4
      switch5:
        friendly_name: USB Switch
        id: 5
